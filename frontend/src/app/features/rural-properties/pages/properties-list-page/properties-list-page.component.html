<div class="page-container">
  <div class="page-header">
    <div class="flex justify-content-between align-items-center">
      <div>
        <h1>Propriedades Rurais</h1>
        <p class="page-subtitle">Gerencie as propriedades rurais cadastradas</p>
      </div>
      <p-button
        label="Nova Propriedade"
        icon="pi pi-plus"
        (onClick)="createProperty()"
      ></p-button>
    </div>
  </div>

  <!-- Filters Card -->
  <p-card styleClass="mb-4">
    <div class="grid">
      <div class="col-12 md:col-4">
        <label for="cropFilter" class="block mb-2">Cultura</label>
        <p-dropdown
          id="cropFilter"
          [(ngModel)]="selectedCrop"
          [options]="cropOptions"
          optionLabel="label"
          optionValue="value"
          placeholder="Selecione a cultura"
          [style]="{'width': '100%'}"
        ></p-dropdown>
      </div>

      <div class="col-12 md:col-4">
        <label class="block mb-2">Filtros Adicionais</label>
        <div class="flex align-items-center h-3rem">
          <input
            type="checkbox"
            id="priorityFilter"
            [(ngModel)]="showOnlyPriority"
            class="mr-2"
          />
          <label for="priorityFilter" class="mb-0 cursor-pointer">
            <i class="pi pi-star-fill text-yellow-500 mr-1"></i>
            Apenas propriedades prioritárias (> 100 ha)
          </label>
        </div>
      </div>

      <div class="col-12 md:col-4 flex align-items-end">
        <div class="flex gap-2 w-full">
          <p-button
            label="Filtrar"
            icon="pi pi-search"
            (onClick)="onFilterChange()"
            [style]="{'flex': '1'}"
          ></p-button>
          <p-button
            label="Limpar"
            icon="pi pi-times"
            severity="secondary"
            [outlined]="true"
            (onClick)="clearFilters()"
            [style]="{'flex': '1'}"
          ></p-button>
        </div>
      </div>
    </div>
  </p-card>

  <!-- Table Card -->
  <p-card>
    <p-table
      [value]="properties"
      [loading]="loading"
      [paginator]="true"
      [rows]="10"
      [rowsPerPageOptions]="[10, 25, 50]"
      [showCurrentPageReport]="true"
      currentPageReportTemplate="Mostrando {first} a {last} de {totalRecords} propriedades"
      [(first)]="first"
      [responsive]="true"
      [tableStyle]="{'min-width': '50rem'}"
      styleClass="p-datatable-striped"
    >
      <ng-template pTemplate="header">
        <tr>
          <th pSortableColumn="leadId">
            Lead <p-sortIcon field="leadId"></p-sortIcon>
          </th>
          <th pSortableColumn="cropType">
            Cultura <p-sortIcon field="cropType"></p-sortIcon>
          </th>
          <th pSortableColumn="areaHectares">
            Área (ha) <p-sortIcon field="areaHectares"></p-sortIcon>
          </th>
          <th>Prioridade</th>
          <th pSortableColumn="createdAt">
            Data de Cadastro <p-sortIcon field="createdAt"></p-sortIcon>
          </th>
          <th class="text-center">Ações</th>
        </tr>
      </ng-template>

      <ng-template pTemplate="body" let-property>
        <tr>
          <td>
            <span class="font-semibold">Lead #{{ property.leadId }}</span>
          </td>
          <td>
            <app-crop-badge [cropType]="property.cropType"></app-crop-badge>
          </td>
          <td>
            <span class="font-semibold">{{ property.areaHectares }}</span> ha
          </td>
          <td>
            <app-priority-indicator
              [areaHectares]="property.areaHectares"
              [showLabel]="true"
            ></app-priority-indicator>
          </td>
          <td>{{ formatDate(property.createdAt) }}</td>
          <td class="text-center">
            <div class="flex gap-2 justify-content-center">
              <p-button
                icon="pi pi-eye"
                severity="info"
                [text]="true"
                [rounded]="true"
                (onClick)="viewProperty(property.id)"
                pTooltip="Visualizar"
                tooltipPosition="top"
              ></p-button>
              <p-button
                icon="pi pi-pencil"
                severity="warning"
                [text]="true"
                [rounded]="true"
                (onClick)="editProperty(property.id)"
                pTooltip="Editar"
                tooltipPosition="top"
              ></p-button>
              <p-button
                icon="pi pi-trash"
                severity="danger"
                [text]="true"
                [rounded]="true"
                (onClick)="deleteProperty(property)"
                pTooltip="Excluir"
                tooltipPosition="top"
              ></p-button>
            </div>
          </td>
        </tr>
      </ng-template>

      <ng-template pTemplate="emptymessage">
        <tr>
          <td colspan="6">
            <div class="flex flex-column align-items-center justify-content-center py-5">
              <i class="pi pi-inbox" style="font-size: 4rem; color: var(--gray-400);"></i>
              <h3 class="mt-4">Nenhuma propriedade encontrada</h3>
              <p class="text-600">Comece cadastrando uma nova propriedade rural.</p>
              <p-button
                label="Criar Propriedade"
                icon="pi pi-plus"
                (onClick)="createProperty()"
                class="mt-3"
              ></p-button>
            </div>
          </td>
        </tr>
      </ng-template>
    </p-table>
  </p-card>
</div>

<p-toast></p-toast>
<p-confirmDialog></p-confirmDialog>
